<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BDProject.Views.HomePage"
             xmlns:local="clr-namespace:BDProject.ViewModels"
             xmlns:selector="clr-namespace:BDProject.Helpers"
             
             xmlns:controls="clr-namespace:ImageCircle.Forms.Plugin.Abstractions;assembly=ImageCircle.Forms.Plugin">

    <ContentPage.Resources>
        <ResourceDictionary>

            <!--===============MY TEMPLATE===============-->
            <DataTemplate x:Key="MyTemplate">
                <Grid 
                    Padding="8,16"
                    RowDefinitions="auto,auto,*,auto">

                    <Grid
                        Grid.Row="0"
                        ColumnDefinitions="auto,auto,*,auto">

                        <controls:CircleImage
                            Grid.Column="0"
                            Source="{Binding UserPhotoSource}"
                            HeightRequest="50"
                            WidthRequest="35"/>

                        <Label 
                            Grid.Column="1"
                            FontSize="Medium"
                            FontAttributes="Bold"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="{Binding Username}"/>

                        <Button 
                            Grid.Column="3"
                            HeightRequest="0"
                            WidthRequest="38"
                            Text=""
                            FontFamily="FA-S"
                            BackgroundColor="{StaticResource White}"
                            Command="{Binding EditPostCommand, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                            }}"
                            CommandParameter="{Binding .}"/>

                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer 
                                Command="{Binding OpenMyProfileCommand, Source={
                                    RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}"
                                CommandParameter="{Binding .}"/>
                        </Grid.GestureRecognizers>

                    </Grid>

                    <Label 
                        Grid.Row="1"
                        FontSize="Medium"
                        TextColor="{StaticResource Black}"
                        Text="{Binding Description}" />

                    <Image 
                        Grid.Row="2"
                        Aspect="Fill"
                        Source="{Binding PhotoSource}">

                        <Image.GestureRecognizers>
                            <TapGestureRecognizer 
                                NumberOfTapsRequired="2"
                                Command="{Binding DoubleTapLikePostItemCommand, Source={
                                    RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                    }}"
                                CommandParameter="{Binding .}"/>
                        </Image.GestureRecognizers>

                    </Image>

                    <Grid 
                        Grid.Row="3"
                        ColumnDefinitions="auto,auto,*,auto,auto,auto,auto">

                        <Label 
                            Grid.Column="0"
                            FontSize="Medium"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="Days" />

                        <Label 
                            Grid.Column="1"
                            FontSize="Medium"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="{Binding DaysCount, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}" />

                        <Button 
                            Grid.Column="3"
                            HeightRequest="46"
                            WidthRequest="46"
                            Text=""
                            FontSize="Large"
                            FontFamily="FA-R"
                            BackgroundColor="{StaticResource White}"
                            Command="{Binding LikePostItemCommand, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}"
                            CommandParameter="{Binding .}"/>

                        <Label 
                            Grid.Column="4"
                            Margin="0,0,16,0"
                            FontSize="Medium"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="{Binding LikesCount, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}" />

                        <Button 
                            Grid.Column="5"
                            HeightRequest="46"
                            WidthRequest="46"
                            Text="" 
                            FontSize="Large"
                            FontFamily="FA-R"
                            BackgroundColor="{StaticResource White}"
                            Command="{Binding OpenPostCommentsCommand, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}"
                            CommandParameter="{Binding .}"/>

                        <Label 
                            Grid.Column="6"
                            FontSize="Medium"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="{Binding CommentsCount, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}" />

                    </Grid>

                </Grid>
            </DataTemplate>

            <!--==============OTHERS TEMPLATE===================-->
            <DataTemplate x:Key="OthersTemplate">
                <Grid 
                    Padding="8,16"
                    RowDefinitions="auto,auto,*,auto">

                    <Grid
                        Grid.Row="0"
                        ColumnDefinitions="auto,auto,*,auto">

                        <controls:CircleImage
                            Grid.Column="0"
                            Source="{Binding UserPhotoSource}"
                            HeightRequest="50"
                            WidthRequest="35"/>
                        
                        <Label 
                            Grid.Column="1"
                            FontSize="Medium"
                            FontAttributes="Bold"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="{Binding Username}"/>

                        <Button 
                            Grid.Column="3"
                            CornerRadius="100"
                            HeightRequest="0"
                            Text="{Binding Following}"
                            FontAttributes="Bold"
                            Command="{Binding FollowProfileCommand, Source={
                                    RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}"
                            CommandParameter="{Binding .}"/>

                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer 
                                Command="{Binding OpenProfileCommand, Source={
                                    RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}"
                                CommandParameter="{Binding .}"/>
                        </Grid.GestureRecognizers>

                    </Grid>

                    <Label 
                        Grid.Row="1"
                        FontSize="Medium"
                        TextColor="{StaticResource Black}"
                        Text="{Binding Description}" />

                    <Image 
                        Grid.Row="2"
                        Aspect="Fill"
                        Source="{Binding PhotoSource}">

                        <Image.GestureRecognizers>
                            <TapGestureRecognizer 
                                NumberOfTapsRequired="2"
                                Command="{Binding DoubleTapLikePostItemCommand, Source={
                                    RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                    }}"
                                CommandParameter="{Binding .}"/>
                        </Image.GestureRecognizers>

                    </Image>

                    <Grid 
                        Grid.Row="3"
                        ColumnDefinitions="auto,auto,*,auto,auto,auto,auto">

                        <Label 
                            Grid.Column="0"
                            FontSize="Medium"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="Days" />

                        <Label 
                            Grid.Column="1"
                            FontSize="Medium"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="{Binding DaysCount, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}" />

                        <Button 
                            Grid.Column="3"
                            HeightRequest="46"
                            WidthRequest="46"
                            Text=""
                            FontSize="Large"
                            FontFamily="FA-R"
                            BackgroundColor="{StaticResource White}"
                            Command="{Binding LikePostItemCommand, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}"
                            CommandParameter="{Binding .}"/>

                        <Label 
                            Grid.Column="4"
                            Margin="0,0,16,0"
                            FontSize="Medium"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="{Binding LikesCount, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}" />

                        <Button 
                            Grid.Column="5"
                            HeightRequest="46"
                            WidthRequest="46"
                            Text="" 
                            FontSize="Large"
                            FontFamily="FA-R"
                            BackgroundColor="{StaticResource White}"
                            Command="{Binding OpenPostCommentsCommand, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}"
                            CommandParameter="{Binding .}"/>

                        <Label 
                            Grid.Column="6"
                            FontSize="Medium"
                            VerticalOptions="Center"
                            TextColor="{StaticResource Black}"
                            Text="{Binding CommentsCount, Source={
                                RelativeSource AncestorType={x:Type local:HomePageViewModel}
                                }}" />

                    </Grid>

                </Grid>
            </DataTemplate>
            
            <!--===================DATA TEMPLATE SELECTOR=====================-->
            <selector:ProfilePostsDataTemplateSelector x:Key="templateSelector"
                MyPosts="{StaticResource MyTemplate}"
                OthersPosts="{StaticResource OthersTemplate}"/>

        </ResourceDictionary>
    </ContentPage.Resources>

    
    
    <ContentPage.Content>

        <Grid RowDefinitions="auto,*">

            <Entry
                Grid.Row="0"
                Margin="8,8,8,0"
                x:Name="Searcher"
                Text="{Binding Search}"
                Focused="Entry_Focused"
                Placeholder=""
                FontFamily="FA-S"/>

            <RefreshView 
                Grid.Row="1"
                IsRefreshing="{Binding IsRefreshing}"
                Command="{Binding RefreshCommand}">

                <CollectionView 
                    SelectionMode="None"
                    x:Name="PostsCollectionView"
                    ItemsSource="{Binding PostsCollection}"
                    ItemTemplate="{StaticResource templateSelector}"/>

            </RefreshView>

        </Grid>
        
    </ContentPage.Content>
</ContentPage>